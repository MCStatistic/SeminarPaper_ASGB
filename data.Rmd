---
title: "Data Wrangling"
author: "Marlon Schumacher"
date: "19 11 2018"
output: html_document
---

## Creating the URL's for 19. BDT
```{r}
# just use its
library(pacman)
p_load(magrittr, dplyr, stringr, downloader, purrr)

# short code for creating all 5800 URL's (19. BTD)
# rep() replicates the object n-times
base <- rep("http://dipbt.bundestag.de/dip21/btd/19/0", each = 5800) 
end <- rep(".pdf", each = 5800)
mid <- rep("/190", each = 5800)

# first step: creating a vector with the values from 00 up to 57 as characters
# second step: creating a vector where each value is replicated 100 times
first <- as.character(sprintf("%02.0f", 00:57)) %>% 
  rep(each = 100) 

# creating a vector which includes the values 0000 up to 5799
# important: sprintf() is used for the 4-digit format
second <- as.character(sprintf("%04.0f", 0000:5799))

urls <- str_c(base, first, mid, second, end, 
              sep = "")

# checking url
head(urls)

# checking length
length(urls)
```

## Testing
```{r}
basename(head(urls))
paste("/19_btd/", head(basename(urls)), sep = "")

urls_test <- urls[2:10]
destination_test <- paste("./19_btd/", basename(urls_test), sep = "")

# testing for loop with url_printing
for(i in seq_along(urls_test)){
    download(urls_test[i], destination_test[i], mode="wb")
  print(urls_test[i])
}
```

## live coding with fabio <3
```{r}
# fn + F2 :)
download

# sleep
sleep_down <- function(...) {
  download(...)
  Sys.sleep(1.5)
}

# creating safely
safe_download <- safely(sleep_down)

map_results <- map2(urls, destinations,
                    ~safe_download(.x, .y, mode ="wb"))

results <- map(map_results, "result") %>% 
  as.character() 
error <- map(map_results, "error") %>% 
  as.character()

tibble(results, error)
```


## Just for validation
```{r}
"http://dipbt.bundestag.de/dip21/btd/19/057/1905741.pdf"
"http://dipbt.bundestag.de/dip21/btd/19/057/1905740.pdf"
"http://dipbt.bundestag.de/dip21/btd/19/057/1905739.pdf"


# changing in /055/ for "Drucksache" starting with 55
"http://dipbt.bundestag.de/dip21/btd/19/055/1905500.pdf"
"http://dipbt.bundestag.de/dip21/btd/19/054/1905499.pdf"

# example for beginning
"http://dipbt.bundestag.de/dip21/btd/19/000/1900009.pdf"
```


